{% extends "dashboard/base.html" %}

{% block title %}Products - Dashboard{% endblock %}
{% block nav_services %}active bg-white/10 text-neutral-content{% endblock %}

{% block breadcrumbs %}
<li><a href="{% url 'core:dashboard' %}" class="hover:text-accent">Dashboard</a></li>
<li class="text-base-content font-medium">Products</li>
{% endblock %}

{% block topbar_actions %}
<a href="{% url 'core:dashboard_service_create' %}" class="btn btn-primary btn-sm rounded-lg gap-1.5">
    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
    <span class="hidden sm:inline">New Product</span>
</a>
{% endblock %}

{% block dashboard_content %}
<div class="flex flex-col gap-5">
    <!-- Stats -->
    <div class="grid grid-cols-2 gap-3">
        <div class="dash-stat-card">
            <div class="flex items-center justify-between mb-2">
                <span class="text-xs text-base-content/40 font-medium">Total Products</span>
                <div class="w-8 h-8 rounded-lg bg-primary/10 flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-primary"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path></svg>
                </div>
            </div>
            <div class="text-2xl font-bold">{{ total_services }}</div>
        </div>
        <div class="dash-stat-card">
            <div class="flex items-center justify-between mb-2">
                <span class="text-xs text-base-content/40 font-medium">Active</span>
                <div class="w-8 h-8 rounded-lg bg-success/10 flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-success"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                </div>
            </div>
            <div class="text-2xl font-bold text-success">{{ active_services }}</div>
        </div>
    </div>

    <!-- Filter + Search -->
    <div class="flex flex-col sm:flex-row gap-3 items-start sm:items-center">
        <div class="flex gap-1.5 flex-wrap">
            <a href="{% url 'core:dashboard_services' %}"
                class="btn btn-sm rounded-lg {{ current_status|default:'active' }} {% if not current_status or current_status == '' %}btn-accent{% else %}btn-ghost{% endif %}">
                All
            </a>
            <a href="{% url 'core:dashboard_services' %}?status=active"
                class="btn btn-sm rounded-lg {% if current_status == 'active' %}btn-accent{% else %}btn-ghost{% endif %}">
                Active
            </a>
            <a href="{% url 'core:dashboard_services' %}?status=inactive"
                class="btn btn-sm rounded-lg {% if current_status == 'inactive' %}btn-accent{% else %}btn-ghost{% endif %}">
                Inactive
            </a>
        </div>
        <div class="flex-1"></div>
        <form method="get" class="flex items-center gap-2 w-full sm:w-auto">
            {% if current_status %}<input type="hidden" name="status" value="{{ current_status }}" />{% endif %}
            <div class="relative flex-1 sm:w-64">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="absolute left-3 top-1/2 -translate-y-1/2 text-base-content/30"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                <input type="text" name="q" value="{{ search_query|default:'' }}" placeholder="Search products..."
                    class="input input-bordered input-sm w-full pl-10 rounded-lg bg-base-100/50" />
            </div>
        </form>
    </div>

    <!-- Products Grid -->
    {% if services %}
    <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4">
        {% for service in services %}
        <a href="{% url 'core:dashboard_service_detail' slug=service.slug %}"
            class="dash-card group hover:border-accent/30 transition-all duration-200 hover:shadow-lg hover:shadow-accent/5">
            <div class="flex items-start justify-between mb-3">
                <div class="w-10 h-10 rounded-xl bg-primary/10 flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-primary"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path></svg>
                </div>
                {% if service.is_active %}
                <span class="w-2.5 h-2.5 rounded-full bg-success mt-1 shrink-0" title="Active"></span>
                {% else %}
                <span class="w-2.5 h-2.5 rounded-full bg-base-content/20 mt-1 shrink-0" title="Inactive"></span>
                {% endif %}
            </div>
            <h3 class="font-bold text-sm group-hover:text-accent transition-colors mb-1">{{ service.name }}</h3>
            <p class="text-xs text-base-content/40 line-clamp-2 mb-4">{{ service.description|default:"No description" }}</p>
            <div class="flex items-center justify-between text-xs text-base-content/30 border-t border-base-300/10 pt-3 mt-auto">
                <span class="font-mono">{{ service.slug }}</span>
                <span class="flex items-center gap-1">
                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect><line x1="1" y1="10" x2="23" y2="10"></line></svg>
                    {{ service.payment_count|default:"0" }} payments
                </span>
            </div>
        </a>
        {% endfor %}
    </div>
    {% else %}
    <div class="flex flex-col items-center justify-center py-16 text-center">
        <div class="w-16 h-16 rounded-2xl bg-base-300/20 flex items-center justify-center mb-4">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="text-base-content/20"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path></svg>
        </div>
        <p class="text-base-content/30 text-sm mb-4">No products found</p>
        <a href="{% url 'core:dashboard_service_create' %}" class="btn btn-primary btn-sm rounded-lg gap-1.5">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
            Create Product
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}
