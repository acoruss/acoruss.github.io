{% load static %}
<!DOCTYPE html>
<html lang="en" data-theme="acoruss">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Dashboard - Acoruss{% endblock %}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
</head>

<body class="min-h-screen bg-base-100">
    <!-- Mobile overlay -->
    <div id="sidebar-overlay" class="fixed inset-0 bg-black/60 z-30 hidden lg:hidden" onclick="toggleSidebar()"></div>

    <div class="flex min-h-screen">
        <!-- Sidebar -->
        <aside id="dashboard-sidebar"
            class="dash-sidebar fixed lg:sticky top-0 left-0 z-40 flex flex-col h-screen bg-neutral text-neutral-content
                   w-64 -translate-x-full lg:translate-x-0 transition-all duration-300 ease-in-out">
            <!-- Logo -->
            <div class="flex items-center gap-3 px-5 py-5 border-b border-white/5">
                <img src="{% static 'images/logos/white.png' %}" alt="Acoruss" class="h-7 sidebar-full">
                <button onclick="toggleSidebarCollapse()" class="ml-auto btn btn-ghost btn-xs btn-circle hidden lg:flex text-neutral-content/50 hover:text-neutral-content" title="Collapse sidebar">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="11 17 6 12 11 7"></polyline>
                        <polyline points="18 17 13 12 18 7"></polyline>
                    </svg>
                </button>
            </div>

            <!-- Navigation -->
            <nav class="flex-1 overflow-y-auto py-4 px-3">
                <ul class="menu menu-sm gap-0.5">
                    <!-- Dashboard -->
                    <li>
                        <a href="{% url 'core:dashboard' %}" class="dash-nav-item flex items-center gap-3 rounded-lg px-3 py-2.5 text-sm font-medium {% block nav_dashboard %}{% endblock %}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="shrink-0">
                                <rect x="3" y="3" width="7" height="7" rx="1"></rect>
                                <rect x="14" y="3" width="7" height="7" rx="1"></rect>
                                <rect x="3" y="14" width="7" height="7" rx="1"></rect>
                                <rect x="14" y="14" width="7" height="7" rx="1"></rect>
                            </svg>
                            <span class="sidebar-label">Dashboard</span>
                        </a>
                    </li>

                    <li class="menu-title text-xs uppercase tracking-wider text-neutral-content/30 mt-5 mb-1 px-3 sidebar-full">Management</li>

                    <!-- Contacts -->
                    <li>
                        <a href="{% url 'core:dashboard_contacts' %}" class="dash-nav-item flex items-center gap-3 rounded-lg px-3 py-2.5 text-sm {% block nav_contacts %}{% endblock %}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="shrink-0">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                <circle cx="12" cy="7" r="4"></circle>
                            </svg>
                            <span class="sidebar-label">Contacts</span>
                        </a>
                    </li>

                    <!-- Payments -->
                    <li>
                        <a href="{% url 'core:dashboard_payments' %}" class="dash-nav-item flex items-center gap-3 rounded-lg px-3 py-2.5 text-sm {% block nav_payments %}{% endblock %}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="shrink-0">
                                <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                                <line x1="1" y1="10" x2="23" y2="10"></line>
                            </svg>
                            <span class="sidebar-label">Payments</span>
                        </a>
                    </li>

                    <!-- Products -->
                    <li>
                        <a href="{% url 'core:dashboard_services' %}" class="dash-nav-item flex items-center gap-3 rounded-lg px-3 py-2.5 text-sm {% block nav_services %}{% endblock %}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="shrink-0">
                                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                                <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                                <line x1="12" y1="22.08" x2="12" y2="12"></line>
                            </svg>
                            <span class="sidebar-label">Products</span>
                        </a>
                    </li>

                    <!-- Analytics -->
                    <li>
                        <a href="{% url 'core:dashboard_analytics' %}" class="dash-nav-item flex items-center gap-3 rounded-lg px-3 py-2.5 text-sm {% block nav_analytics %}{% endblock %}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="shrink-0">
                                <line x1="18" y1="20" x2="18" y2="10"></line>
                                <line x1="12" y1="20" x2="12" y2="4"></line>
                                <line x1="6" y1="20" x2="6" y2="14"></line>
                            </svg>
                            <span class="sidebar-label">Analytics</span>
                        </a>
                    </li>
                </ul>
            </nav>

            <!-- Bottom section -->
            <div class="border-t border-white/5 p-3">
                <ul class="menu menu-sm gap-0.5">
                    <li>
                        <a href="{% url 'core:index' %}" target="_blank" class="dash-nav-item flex items-center gap-3 rounded-lg px-3 py-2 text-sm text-neutral-content/60 hover:text-neutral-content">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="shrink-0">
                                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                                <polyline points="15 3 21 3 21 9"></polyline>
                                <line x1="10" y1="14" x2="21" y2="3"></line>
                            </svg>
                            <span class="sidebar-label">View Website</span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'core:dashboard_logout' %}" class="dash-nav-item flex items-center gap-3 rounded-lg px-3 py-2 text-sm text-neutral-content/60 hover:text-error">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="shrink-0">
                                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                                <polyline points="16 17 21 12 16 7"></polyline>
                                <line x1="21" y1="12" x2="9" y2="12"></line>
                            </svg>
                            <span class="sidebar-label">Logout</span>
                        </a>
                    </li>
                </ul>

                <!-- User info -->
                <div class="flex items-center gap-3 mt-3 px-3 py-2 rounded-lg bg-white/5 sidebar-full">
                    <div class="avatar placeholder">
                        <div class="bg-accent text-accent-content rounded-full w-8 h-8">
                            <span class="text-xs font-bold">{{ request.user.first_name|default:request.user.username|make_list|first|upper }}</span>
                        </div>
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="text-sm font-medium truncate">{{ request.user.get_full_name|default:request.user.username }}</div>
                        <div class="text-xs text-neutral-content/40 truncate">{{ request.user.email }}</div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main content area -->
        <div class="flex-1 flex flex-col min-h-screen min-w-0">
            <!-- Top bar -->
            <header class="sticky top-0 z-20 flex items-center gap-3 px-4 lg:px-6 h-14 bg-base-100/80 backdrop-blur-xl border-b border-base-300/30">
                <!-- Mobile menu toggle -->
                <button onclick="toggleSidebar()" class="btn btn-ghost btn-sm btn-square lg:hidden">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <line x1="3" y1="12" x2="21" y2="12"></line>
                        <line x1="3" y1="18" x2="21" y2="18"></line>
                    </svg>
                </button>

                <!-- Breadcrumbs -->
                <div class="flex-1 min-w-0">
                    <div class="text-sm breadcrumbs py-0">
                        <ul class="text-base-content/50">
                            {% block breadcrumbs %}
                            <li><a href="{% url 'core:dashboard' %}" class="hover:text-accent">Dashboard</a></li>
                            {% endblock %}
                        </ul>
                    </div>
                </div>

                <!-- Right actions -->
                <div class="flex items-center gap-2">
                    {% block topbar_actions %}{% endblock %}

                    <!-- User dropdown (desktop) -->
                    <div class="dropdown dropdown-end hidden sm:block">
                        <div tabindex="0" role="button" class="btn btn-ghost btn-sm gap-2">
                            <div class="avatar placeholder">
                                <div class="bg-accent text-accent-content rounded-full w-7 h-7">
                                    <span class="text-xs font-bold">{{ request.user.first_name|default:request.user.username|make_list|first|upper }}</span>
                                </div>
                            </div>
                            <span class="text-sm hidden md:inline">{{ request.user.get_short_name|default:request.user.username }}</span>
                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
                        </div>
                        <ul tabindex="0" class="dropdown-content menu bg-base-200 border border-base-300/50 rounded-xl w-52 p-2 shadow-xl mt-2 z-50">
                            <li><a href="{% url 'core:index' %}" target="_blank">View Website</a></li>
                            <li><a href="{% url 'core:dashboard_logout' %}" class="text-error">Logout</a></li>
                        </ul>
                    </div>
                </div>
            </header>

            <!-- Page content -->
            <main class="flex-1 p-4 lg:p-6">
                <!-- Flash messages -->
                {% if messages %}
                <div class="mb-4 space-y-2">
                    {% for message in messages %}
                    <div class="alert {% if message.tags == 'success' %}alert-success{% elif message.tags == 'error' %}alert-error{% elif message.tags == 'warning' %}alert-warning{% else %}alert-info{% endif %} shadow-sm">
                        <span>{{ message }}</span>
                        <button class="btn btn-ghost btn-xs" onclick="this.parentElement.remove()">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                        </button>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}

                {% block dashboard_content %}{% endblock %}
            </main>
        </div>
    </div>

    <script src="{% static 'js/main.js' %}"></script>
    <script>
        // Dashboard sidebar toggle for mobile
        function toggleSidebar() {
            const sidebar = document.getElementById('dashboard-sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            sidebar.classList.toggle('-translate-x-full');
            overlay.classList.toggle('hidden');
        }

        // Collapse sidebar on desktop (icon-only mode)
        function toggleSidebarCollapse() {
            const sidebar = document.getElementById('dashboard-sidebar');
            sidebar.classList.toggle('dash-sidebar-collapsed');
            localStorage.setItem('sidebar-collapsed', sidebar.classList.contains('dash-sidebar-collapsed'));
        }

        // Restore collapsed state on load
        (function() {
            if (localStorage.getItem('sidebar-collapsed') === 'true') {
                document.getElementById('dashboard-sidebar').classList.add('dash-sidebar-collapsed');
            }
        })();

        // Close sidebar on mobile when clicking a nav link
        document.querySelectorAll('#dashboard-sidebar .dash-nav-item').forEach(function(link) {
            link.addEventListener('click', function() {
                if (window.innerWidth < 1024) {
                    toggleSidebar();
                }
            });
        });

        // Close dropdowns when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.dropdown')) {
                document.querySelectorAll('.dropdown [tabindex="0"]').forEach(function(el) {
                    el.blur();
                });
            }
        });
    </script>
    {% block extra_js %}{% endblock %}
</body>

</html>