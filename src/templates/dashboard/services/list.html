{% extends "dashboard/base.html" %}

{% block title %}Products &amp; Services - Dashboard{% endblock %}

{% block dashboard_content %}
<div class="flex flex-col gap-6">
    <div class="flex items-center justify-between">
        <h1 class="text-3xl font-bold">Products &amp; Services</h1>
        <a href="{% url 'core:dashboard_service_create' %}" class="btn btn-primary btn-sm rounded-full gap-1">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19" />
                <line x1="5" y1="12" x2="19" y2="12" />
            </svg>
            Add Product
        </a>
    </div>

    <!-- Stats -->
    <div class="stats shadow bg-base-200/50 border border-base-300/30">
        <div class="stat">
            <div class="stat-title">Total Products</div>
            <div class="stat-value text-primary">{{ total_services }}</div>
        </div>
        <div class="stat">
            <div class="stat-title">Active</div>
            <div class="stat-value text-success">{{ active_services }}</div>
        </div>
    </div>

    <!-- Filters -->
    <div class="flex flex-wrap gap-3 items-center">
        <div class="tabs tabs-boxed bg-base-200/50">
            <a href="{% url 'core:dashboard_services' %}"
                class="tab {% if current_status == 'all' %}tab-active{% endif %}">All</a>
            <a href="{% url 'core:dashboard_services' %}?status=active"
                class="tab {% if current_status == 'active' %}tab-active{% endif %}">Active</a>
            <a href="{% url 'core:dashboard_services' %}?status=inactive"
                class="tab {% if current_status == 'inactive' %}tab-active{% endif %}">Inactive</a>
        </div>
        <form method="get" action="{% url 'core:dashboard_services' %}" class="flex-1 max-w-xs">
            <input type="text" name="q" value="{{ search_query }}" placeholder="Search products..."
                class="input input-bordered input-sm w-full rounded-lg" />
        </form>
    </div>

    <!-- Services Grid -->
    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
        {% for service in services %}
        <a href="{% url 'core:dashboard_service_detail' slug=service.slug %}"
            class="bg-base-200/50 border border-base-300/30 rounded-2xl p-6 hover:shadow-lg transition-shadow cursor-pointer block">
            <div class="flex items-start justify-between mb-3">
                <div>
                    <h3 class="font-bold text-lg">{{ service.name }}</h3>
                    <p class="text-xs text-base-content/50 font-mono">{{ service.slug }}</p>
                </div>
                {% if service.is_active %}
                <span class="badge badge-success badge-sm">Active</span>
                {% else %}
                <span class="badge badge-ghost badge-sm">Inactive</span>
                {% endif %}
            </div>
            {% if service.description %}
            <p class="text-sm text-base-content/60 mb-4 line-clamp-2">{{ service.description }}</p>
            {% endif %}
            <div class="grid grid-cols-3 gap-2 text-center">
                <div>
                    <div class="text-lg font-bold text-primary">{{ service.payment_count }}</div>
                    <div class="text-xs text-base-content/50">Payments</div>
                </div>
                <div>
                    <div class="text-lg font-bold text-success">{{ service.successful_payments }}</div>
                    <div class="text-xs text-base-content/50">Successful</div>
                </div>
                <div>
                    <div class="text-lg font-bold text-accent">{{ service.total_revenue|floatformat:0 }}</div>
                    <div class="text-xs text-base-content/50">Revenue</div>
                </div>
            </div>
        </a>
        {% empty %}
        <div class="col-span-full text-center py-12 text-base-content/50">
            <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto mb-3 w-12 h-12 opacity-40" fill="none"
                viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
            </svg>
            <p class="font-semibold mb-1">No products registered yet</p>
            <p class="text-sm">Add a product to start accepting payments from external services.</p>
        </div>
        {% endfor %}
    </div>

    <!-- Pagination -->
    {% if is_paginated %}
    <div class="flex justify-center">
        <div class="join">
            {% if page_obj.has_previous %}
            <a href="?page={{ page_obj.previous_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}"
                class="join-item btn btn-sm">&laquo;</a>
            {% endif %}
            {% for num in page_obj.paginator.page_range %}
            <a href="?page={{ num }}{% if search_query %}&q={{ search_query }}{% endif %}"
                class="join-item btn btn-sm {% if page_obj.number == num %}btn-active{% endif %}">{{ num }}</a>
            {% endfor %}
            {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}"
                class="join-item btn btn-sm">&raquo;</a>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}